# CLAUDE.md

このプロジェクトの開発方針を定義します。

---

## 技術スタック

| カテゴリ | 技術 | 用途 |
|----------|------|------|
| ランタイム | **Bun** | 高速なJavaScript/TypeScriptランタイム・パッケージマネージャー |
| 言語 | **TypeScript** | 型安全な開発 |
| ORM | **Prisma** | データベースアクセス・スキーマ管理 |
| データベース | **MongoDB** | ドキュメント指向データベース |

### コマンド例

```bash
# 依存関係インストール
bun install

# 開発サーバー起動
bun run dev

# テスト実行
bun test

# Prismaスキーマ反映
bunx prisma db push

# Prisma Client生成
bunx prisma generate
```

---

## 開発原則

### 1. テスト駆動開発 (TDD)

テストファーストで開発を進めます。

- **Red**: 失敗するテストを先に書く
- **Green**: テストを通す最小限のコードを実装する
- **Refactor**: コードを整理・改善する

テストは仕様であり、ドキュメントです。

### 2. SOLID原則

クリーンアーキテクチャを維持するため、SOLID原則に従います。

| 原則 | 説明 |
|------|------|
| **S** - 単一責任 | 1つのモジュールは1つの責任のみを持つ |
| **O** - 開放閉鎖 | 拡張に開き、修正に閉じる |
| **L** - リスコフ置換 | 派生クラスは基底クラスと置換可能であるべき |
| **I** - インターフェース分離 | クライアントが使わないメソッドへの依存を強制しない |
| **D** - 依存性逆転 | 具象ではなく抽象に依存する |

責任を明確に分離し、クリーンなインターフェースで結合します。

### 3. YAGNI (You Ain't Gonna Need It)

シンプルな設計を維持します。

- 今必要な機能だけを実装する
- 「将来使うかも」という理由で機能を追加しない
- 必要になった時点で拡張する

---

## 実践ガイドライン

```
新機能を追加する際のフロー:

1. 要件を明確にする
2. テストを書く（失敗することを確認）
3. 最小限の実装でテストを通す
4. リファクタリング
5. コミット
```

## 禁止事項

- テストなしでの本番コード追加
- 「念のため」の機能追加
- 巨大なクラス・関数の作成
- 具象クラスへの直接依存

---

## Git戦略

**Trunk-Based Development + git worktree + 小さいPR** を採用します。

### 基本方針

- `main`ブランチを常にデプロイ可能な状態に保つ
- 短命なfeatureブランチで小さな変更を頻繁にマージ
- git worktreeで複数作業を並行して進める

```
main (trunk)
  │
  ├── feature/task-a  ← 小さい単位で作成、すぐマージ
  ├── feature/task-b
  └── feature/task-c
```

### git worktree 運用

```bash
# worktree作成（別ディレクトリで並行作業）
git worktree add ../project-feature-a feature/task-a

# worktree一覧
git worktree list

# 作業完了後、worktree削除
git worktree remove ../project-feature-a
```

### 小さいPRのルール

| ルール | 内容 |
|--------|------|
| サイズ | 1PRあたり **200行以下** を目安 |
| スコープ | 1つの機能・修正に限定 |
| 寿命 | ブランチは **1日以内** にマージを目指す |
| レビュー | 小さいほどレビューが早く、品質が上がる |

### フロー

1. `main`から短命なfeatureブランチを作成
2. git worktreeで並行作業が必要な場合は別ディレクトリに展開
3. 小さい単位で実装・テスト
4. PRを作成し、レビュー後すぐに`main`へマージ
5. featureブランチ・worktreeを削除

```
⚠️ 長寿命ブランチは禁止。大きな機能はフィーチャーフラグで段階的にリリース。
```

---

## コードベースのドキュメント化

### CODEBASE.md

プロジェクトのコードベース構造を`CODEBASE.md`で管理します。

**目的**: このファイルを読めば、現在のコードベース全体を理解できる状態を維持する

**記載内容**:
- ディレクトリ構造
- 主要モジュールの責務
- 依存関係
- エントリーポイント

**更新タイミング**:
- 新しいモジュール追加時
- アーキテクチャ変更時
- ディレクトリ構造変更時

```
⚠️ コードベースに大きな変更を加えたら、CODEBASE.mdも更新すること
```
